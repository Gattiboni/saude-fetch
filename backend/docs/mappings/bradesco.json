{
  "meta": { "provider": "bradesco", "task": "cpf-eligibility", "version": "1.0.0" },
  "navigate": {
    "url": "https://www.bradescoseguros.com.br/clientes/produtos/plano-saude/consulta-de-rede-referenciada",
    "expand_recursively": true,
    "reuse_page": true,
    "accept_cookies": { "selector": "#adopt-accept-all-button", "action": "click", "optional": true, "timeout_ms": 5000 }
  },
  "guards": {
    "captcha": {
      "selectors": ["iframe[title*='captcha']", "div.g-recaptcha", "div.hcaptcha-box", "div[aria-label*='captcha']"],
      "strategy": "abort",
      "report": "CAPTCHA detected - aborting as requested"
    }
  },
  "inputs": {
    "cpf": { "selector": "#searchCpfOrCard", "type": "text", "mask": "cpf", "submit": "enter", "clear": true }
  },
  "steps": [
    {
      "wait_for": {
        "any": [
          { "selector": ".bs-modal__container .bs-alert__title", "timeout_ms": 8000 },
          { "selector": "#bs-modal-selecioneBeneficiario .bs-alert__title", "timeout_ms": 8000 }
        ]
      }
    },
    {
      "conditional": [
        {
          "if": { "exists": { "selector": ".bs-modal__container .bs-alert__title", "text_equals": "Beneficiário não encontrado" } },
          "then": [
            { "set": { "result": "negative", "reason": "Beneficiário não encontrado" } },
            { "click": { "selector": ".bs-modal__body .bs-button.bs-alert__button", "timeout_ms": 4000 } }
          ]
        },
        {
          "if": { "exists": { "selector": "#bs-modal-selecioneBeneficiario .bs-alert__title", "text_equals": "Selecione o beneficiário" } },
          "then": [
            { "set": { "result": "positive" } },
            { "click": { "selector": "#bs-modal-selecioneBeneficiario .bs-modal__close-btn", "timeout_ms": 4000 } }
          ]
        }
      ]
    }
  ],
  "loop": { "reenter_on": "next_input", "keep_page_open": true },
  "errors": { "on_captcha": "abort", "on_timeout": "retry_once_then_fail" }
}
