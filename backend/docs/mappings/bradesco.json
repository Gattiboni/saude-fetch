{
  "meta": { "provider": "bradesco", "task": "cpf-eligibility", "version": "1.0.0" },
  "navigate": {
    "url": "https://www.bradescoseguros.com.br/clientes/produtos/plano-saude/consulta-de-rede-referenciada",
    "expand_recursively": true,
    "reuse_page": true,
    "accept_cookies": {
      "selector": "#onetrust-accept-btn-handler, button[id*='onetrust'], button[data-testid='accept-all'], button:has-text('Aceitar'), button:has-text('Continuar'), #adopt-accept-all-button",
      "action": "click",
      "optional": true,
      "timeout_ms": 4000
    }
  },
  "guards": {
    "captcha": {
      "selectors": ["iframe[title*='captcha']", "div.g-recaptcha", "div.hcaptcha-box", "div[aria-label*='captcha']"],
      "strategy": "abort",
      "report": "CAPTCHA detected - aborting as requested"
    }
  },
  "inputs": {
    "cpf": { "selector": "#searchCpfOrCard", "type": "text", "mask": "cpf", "submit": "enter", "clear": true }
  },
  "steps": [
    {
      "action": "navigate",
      "target": "https://www.bradescoseguros.com.br/clientes/produtos/plano-saude/consulta-de-rede-referenciada",
      "wait_for_any": [
        "input#searchCpfOrCard",
        "input[name='searchCpfOrCard']",
        "input[placeholder*='cpf' i]"
      ],
      "timeout_ms": 20000
    },
    {
      "action": "click",
      "selector": "#onetrust-accept-btn-handler, button[id*='onetrust'], button[data-testid='accept-all'], button:has-text('Aceitar'), button:has-text('Continuar'), #adopt-accept-all-button",
      "optional": true,
      "timeout_ms": 4000,
      "force": true
    },
    {
      "action": "wait_for_timeout",
      "timeout_ms": 1000
    },
    {
      "action": "fill",
      "selector": "input#searchCpfOrCard",
      "value": "{identifier}",
      "timeout_ms": 20000
    },
    {
      "action": "keypress",
      "selector": "input#searchCpfOrCard",
      "key": "Enter",
      "timeout_ms": 15000
    },
    {
      "action": "wait_for",
      "selector": [
        "div.bs-modal__container strong.bs-alert__title",
        "text=/beneficiário não encontrado/i",
        "text=/selecione o beneficiário/i"
      ],
      "timeout_ms": 20000
    },
    {
      "action": "evaluate",
      "expression": "(() => {\n  const title = document.querySelector('div.bs-modal__container strong.bs-alert__title');\n  if (title) {\n    const text = title.innerText.toLowerCase();\n    if (text.includes('beneficiário não encontrado')) return 'negativo';\n    if (text.includes('selecione o beneficiário')) return 'positivo';\n  }\n  return 'indefinido';\n})()"
    },
    {
      "action": "keyboard",
      "key": "Escape",
      "timeout_ms": 1000
    },
    {
      "action": "wait_for_timeout",
      "timeout_ms": 500
    }
  ],
  "result_parsing": {
    "status_selectors": [
      "div.bs-modal__container strong.bs-alert__title",
      ".bs-modal__body",
      ".bs-alert__content",
      "text=/beneficiário não encontrado/i",
      "text=/selecione o beneficiário/i"
    ],
    "status_timeout_ms": 20000,
    "status_poll_interval_ms": 400,
    "positive_keywords": [
      "SELECIONE O BENEFICIÁRIO",
      "BENEFICIÁRIO ENCONTRADO",
      "ATIVO"
    ],
    "negative_keywords": [
      "BENEFICIÁRIO NÃO ENCONTRADO",
      "DADOS INVÁLIDOS"
    ],
    "error_keywords": [
      "ERRO",
      "INVÁLIDO",
      "NÃO ENCONTRADO",
      "TENTE NOVAMENTE"
    ],
    "plan_selectors": [
      ".bs-modal__body",
      ".bs-alert__content",
      ".input-redux__error span"
    ],
    "plan_optional": true
  },
  "notes": "Após enviar o CPF com Enter, modais e mensagens inline exibem o resultado. Os seletores toleram variações de modal e mensagens de erro."
}
