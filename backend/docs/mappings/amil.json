{
  "meta": { "provider": "amil", "task": "cpf-eligibility", "version": "1.0.0" },
  "navigate": {
    "url": "https://www.amil.com.br/institucional/#/servicos/saude/rede-credenciada/amil/busca-avancada",
    "expand_recursively": true,
    "reuse_page": true,
    "accept_cookies": { "selector": "#onetrust-accept-btn-handler", "action": "click", "optional": true, "timeout_ms": 5000 }
  },
  "inputs": {
    "cpf": { "selector": "#cpf_input", "type": "text", "mask": "cpf", "submit": "enter", "clear": true, "timeout_ms": 120000 }
  },
  "steps": [
    {
      "wait_for": {
        "any": [
          { "selector": ".modal-content .modal-title", "timeout_ms": 7000 },
          { "selector": ".rw-input.rw-dropdown-list-input", "timeout_ms": 7000 }
        ]
      }
    },
    {
      "conditional": [
        {
          "if": { "exists": { "selector": ".modal-content #custom-modal-description", "text_contains": "Nenhum resultado encontrado." } },
          "then": [
            { "set": { "result": "negative", "reason": "Nenhum resultado encontrado" } },
            { "click": { "selector": ".modal-footer .btn.btn-primary", "timeout_ms": 4000 } }
          ]
        },
        {
          "if": { "exists": { "selector": ".rw-input.rw-dropdown-list-input", "text_not_in": ["", "Plano ou rede"] } },
          "then": [
            { "set": { "result": "positive" } },
            { "extract": { "plan_name": { "selector": ".rw-input.rw-dropdown-list-input", "attribute": "innerText" } } }
          ]
        },
        {
          "else": [
            { "set": { "result": "negative", "reason": "Placeholder permaneceu (Plano ou rede)" } }
          ]
        }
      ]
    }
  ],
  "loop": { "reenter_on": "next_input", "keep_page_open": true },
  "errors": { "on_timeout": "retry_once_then_fail" }
}